<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
    <script type="text/javascript" src="demodulate.js"></script>
    <canvas id="waveform0" width="1024" height="256"></canvas> <br>
    <canvas id="waveform1" width="1024" height="256"></canvas> <br>
    <canvas id="waveform2" width="1024" height="256" hint="abc"></canvas> <br>

    sampling rate:<input type="text" id="fs" value="44100" disabled><br>
    noise threshold:<input type="text" id="noiseThreshold" value=""><br>
    bit threshold:<input type="text" id="bitThreshold" value=""><br>
    samples per bit:<input type="text" id="t_b" value=""><br>
    <button onclick="update()">update</button>

    <script>
      var noiseThresholdBox = null;
      var bitThresholdBox = null;
      var t_bBox = null;
      var canvasses = [];
      var canvasIndex = 0;

      function update() {
	noiseThreshold = parseFloat(noiseThresholdBox.value);
	bitThreshold = parseFloat(bitThresholdBox.value);
	t_b = parseInt(t_bBox.value);
	aligned_buffer_length = 0;
      }
      function onDOMLoad() {
	noiseThresholdBox = document.getElementById("noiseThreshold");
	bitThresholdBox = document.getElementById("bitThreshold");
	t_bBox = document.getElementById("t_b");
	noiseThresholdBox.value = noiseThreshold;
	bitThresholdBox.value = bitThreshold;
	t_bBox.value = t_b;

	canvasses = [
	  document.getElementById("waveform0").getContext("2d"),
	  document.getElementById("waveform1").getContext("2d"),
	  document.getElementById("waveform2").getContext("2d"),
	];
	drawBufferCallback = function(buf) {
	  updateWaveCanvas(canvasses[canvasIndex], buf);
	  canvasIndex = (canvasIndex + 1) % canvasses.length;
	}
      }
      document.addEventListener("DOMContentLoaded", onDOMLoad);


      function updateWaveCanvas(waveCanvas, buf) {
	var canvasLength = 1024;
	var stepSize = 128;
	waveCanvas.clearRect(0, 0, 1024, 256);
	waveCanvas.strokeStyle = "red";
	waveCanvas.beginPath();
	for (var i = 0; i <= canvasLength / stepSize ; i += 1) {
	  waveCanvas.moveTo(i * stepSize, 0);
	  waveCanvas.lineTo(i * stepSize, 256);
	}
	waveCanvas.stroke();
	waveCanvas.strokeStyle = "black";
	waveCanvas.beginPath();
	waveCanvas.moveTo(0, 128 + buf[0] * 128);
	for (var i = 1; i < canvasLength; i++) {
	  waveCanvas.lineTo(i, 128 + (buf[i * (buf.length / canvasLength)] * 128));
	}
	waveCanvas.stroke();
      }
    </script>
  </body>
</html>
